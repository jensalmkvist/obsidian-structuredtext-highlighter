/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => StructuredTextSyntaxHighlighterPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian2 = require("obsidian");

// loadPrismWithST.ts
var import_obsidian = require("obsidian");
var applyPrismST = (Prism) => {
  const controlKeywordGroups = {
    ifStatementKeywords: ["IF", "ELSIF", "ELSE", "THEN", "END_IF"],
    caseStatementKeywords: ["CASE", "OF", "END_CASE"],
    forStateMentKeywords: ["FOR", "TO", "BY", "DO", "END_FOR"],
    whileStatementKeywords: ["WHILE", "DO", "END_WHILE"],
    repeatStatmentKeywords: ["REPEAT", "UNTIL", "END_REPEAT"],
    continueKeyword: ["CONTINUE"],
    exitStatementKeywords: ["EXIT"],
    returnStatementKeywords: ["RETURN"]
  };
  const typedKeywordGroups = {
    intKeywords: ["USINT", "SINT", "UINT", "INT", "UDINT", "DINT", "ULINT", "LINT"],
    floatKeywords: ["REAL", "LREAL"],
    boolKeywords: ["BOOL"],
    stringKeywords: ["STRING", "WSTRING"],
    binKeywords: ["BYTE", "WORD", "DWORD", "LWORD"],
    timeKeywords: ["TIME", "LTIME"]
  };
  const declarationKeywords = {
    variables: ["VAR", "VAR_INPUT", "VAR_OUTPUT", "VAR_IN_OUT", "VAR_TEMP", "VAR_CONSTANT", "END_VAR"],
    types: ["TYPE", "END_TYPE", "STRUCT", "END_STRUCT"],
    functions: ["FUNCTION", "END_FUNCTION", "FUNCTION_BLOCK", "END_FUNCTION_BLOCK"]
  };
  const allKeywords = [
    ...Object.values(controlKeywordGroups).flat(),
    ...Object.values(typedKeywordGroups).flat(),
    ...Object.values(declarationKeywords).flat()
  ];
  const keywordRegex = new RegExp(`\\b(${allKeywords.join("|")})(?=$|\\s|[^\\w])`, "i");
  Prism.languages.structuredtext = Prism.languages.extend("clike", {
    keyword: keywordRegex,
    boolean: /\b(TRUE|FALSE)\b/,
    operator: /\b(AND|OR|NOT|XOR)\b|:=|<>|<=|>=|<|>/,
    number: /\b\d+(\.\d+)?\b/,
    punctuation: /[();,]/,
    identifier: /\b[A-Za-z_][A-Za-z0-9_]*\b/
  });
  Prism.hooks.add("wrap", (env) => {
    if (env.type === "entity") {
      env.attributes["title"] = env.content.replace(/&amp;/, "&");
    }
  });
};
var loadPrismWithST = async () => {
  try {
    const Prism = await (0, import_obsidian.loadPrism)();
    applyPrismST(Prism);
    return Prism;
  } catch (error) {
    console.error("Failed to load Prism:", error);
    throw error;
  }
};
var loadPrismWithST_default = loadPrismWithST;

// structuredtextHighlighter.ts
var import_view = require("@codemirror/view");
var import_state = require("@codemirror/state");
var StructuredTextHighlight = class {
  constructor(view) {
    this.decorations = import_view.Decoration.none;
    this.loadPrism().then(() => {
      this.decorations = this.buildDecorations(view);
      view.update([]);
    });
  }
  update(update) {
    if (update.viewportChanged || update.docChanged) {
      this.decorations = this.buildDecorations(update.view);
    }
  }
  async loadPrism() {
    this.prism = await loadPrismWithST_default();
  }
  buildDecorations(view) {
    const builder = new import_state.RangeSetBuilder();
    if (!this.prism) {
      return import_view.Decoration.none;
    }
    const text = view.state.doc.toString();
    const regex = /```structuredtext(?:[\s\S]*?)([\s\S]*?)\n```/gi;
    let match;
    while ((match = regex.exec(text)) !== null) {
      const codeBlock = match[1];
      const highlighted = this.prism.highlight(codeBlock, this.prism.languages.structuredtext, "structuredtext");
      const blockStart = match.index + match[0].indexOf(match[1]);
      this.applyHighlighting(highlighted, blockStart, builder);
    }
    return builder.finish();
  }
  applyHighlighting(highlighted, blockStart, builder) {
    const parser = new DOMParser();
    const doc = parser.parseFromString(highlighted, "text/html");
    const tempEl = doc.body;
    let currentIndex = blockStart;
    const ranges = [];
    const traverse = (node) => {
      if (node.nodeType === Node.TEXT_NODE) {
        const text = node.textContent || "";
        currentIndex += text.length;
      } else if (node.nodeType === Node.ELEMENT_NODE) {
        const element = node;
        const className = element.className;
        const start = currentIndex;
        element.childNodes.forEach((child) => traverse(child));
        const end = currentIndex + 1;
        if (className && end > start) {
          ranges.push({ start, end, className });
        }
      }
    };
    tempEl.childNodes.forEach((child) => traverse(child));
    ranges.sort((a, b) => a.start - b.start);
    for (const range of ranges) {
      builder.add(range.start, range.end, import_view.Decoration.mark({ class: range.className }));
    }
  }
};

// main.ts
var import_view2 = require("@codemirror/view");
console.log("StructuredText plugin file loaded");
var StructuredTextSyntaxHighlighterPlugin = class extends import_obsidian2.Plugin {
  async onload() {
    console.log("Reached onload");
    try {
      console.log("Loading Structured Text Highlighter Plugin");
      this.obsidianPrism = await loadPrismWithST_default();
      console.log("prism loaded");
      this.registerMarkdownPostProcessor((el, ctx) => {
        el.querySelectorAll("pre > code.language-structuredtext").forEach((block) => {
          this.obsidianPrism.highlightElement(block);
        });
      });
      this.registerEditorExtension(
        import_view2.ViewPlugin.fromClass(StructuredTextHighlight, {
          decorations: (plugin) => plugin.decorations
        })
      );
      this.app.workspace.updateOptions();
    } catch (error) {
      console.error("Failed to load Prism: ", error);
    }
  }
  onunload() {
    console.log("Unloading Structured Text Syntax Highlighter Plugin");
    if (this.obsidianPrism && this.obsidianPrism.languages.structuredtext) {
      delete this.obsidianPrism.languages.structuredtext;
    }
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJsb2FkUHJpc21XaXRoU1QudHMiLCAic3RydWN0dXJlZHRleHRIaWdobGlnaHRlci50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgUGx1Z2luIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgbG9hZFByaXNtV2l0aFNUIGZyb20gJ2xvYWRQcmlzbVdpdGhTVCc7XHJcbmltcG9ydCBTdHJ1Y3R1cmVkVGV4dEhpZ2hsaWdodGVyIGZyb20gJ3N0cnVjdHVyZWR0ZXh0SGlnaGxpZ2h0ZXInO1xyXG5pbXBvcnQgeyBWaWV3UGx1Z2luIH0gZnJvbSAnQGNvZGVtaXJyb3Ivdmlldyc7XHJcblxyXG5jb25zb2xlLmxvZyhcIlN0cnVjdHVyZWRUZXh0IHBsdWdpbiBmaWxlIGxvYWRlZFwiKTtcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU3RydWN0dXJlZFRleHRTeW50YXhIaWdobGlnaHRlclBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XHJcbiAgb2JzaWRpYW5QcmlzbTogYW55O1xyXG5cclxuICBhc3luYyBvbmxvYWQoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnUmVhY2hlZCBvbmxvYWQnKTtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdMb2FkaW5nIFN0cnVjdHVyZWQgVGV4dCBIaWdobGlnaHRlciBQbHVnaW4nKTtcclxuICAgICAgdGhpcy5vYnNpZGlhblByaXNtID0gYXdhaXQgbG9hZFByaXNtV2l0aFNUKCk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdwcmlzbSBsb2FkZWQnKTtcclxuXHJcbiAgICAgIHRoaXMucmVnaXN0ZXJNYXJrZG93blBvc3RQcm9jZXNzb3IoKGVsLCBjdHgpID0+IHtcclxuICAgICAgICBlbC5xdWVyeVNlbGVjdG9yQWxsKCdwcmUgPiBjb2RlLmxhbmd1YWdlLXN0cnVjdHVyZWR0ZXh0JykuZm9yRWFjaCgoYmxvY2spID0+IHtcclxuICAgICAgICAgIHRoaXMub2JzaWRpYW5QcmlzbS5oaWdobGlnaHRFbGVtZW50KGJsb2NrKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0aGlzLnJlZ2lzdGVyRWRpdG9yRXh0ZW5zaW9uKFxyXG4gICAgICAgIFZpZXdQbHVnaW4uZnJvbUNsYXNzKFN0cnVjdHVyZWRUZXh0SGlnaGxpZ2h0ZXIsIHtcclxuICAgICAgICAgIGRlY29yYXRpb25zOiAocGx1Z2luKSA9PiBwbHVnaW4uZGVjb3JhdGlvbnMsXHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuXHJcbiAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS51cGRhdGVPcHRpb25zKCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9hZCBQcmlzbTogJywgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgb251bmxvYWQoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnVW5sb2FkaW5nIFN0cnVjdHVyZWQgVGV4dCBTeW50YXggSGlnaGxpZ2h0ZXIgUGx1Z2luJyk7XHJcblxyXG4gICAgaWYgKHRoaXMub2JzaWRpYW5QcmlzbSAmJiB0aGlzLm9ic2lkaWFuUHJpc20ubGFuZ3VhZ2VzLnN0cnVjdHVyZWR0ZXh0KSB7XHJcbiAgICAgIGRlbGV0ZSB0aGlzLm9ic2lkaWFuUHJpc20ubGFuZ3VhZ2VzLnN0cnVjdHVyZWR0ZXh0O1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iLCAiaW1wb3J0IHsgbG9hZFByaXNtIH0gZnJvbSBcIm9ic2lkaWFuXCI7XHJcblxyXG5cclxuXHJcbmNvbnN0IGFwcGx5UHJpc21TVCA9IChQcmlzbTogYW55KSA9PiB7XHJcblxyXG4gIGNvbnN0IGNvbnRyb2xLZXl3b3JkR3JvdXBzID0ge1xyXG5cclxuICAgIGlmU3RhdGVtZW50S2V5d29yZHM6IFsnSUYnLCAnRUxTSUYnLCAnRUxTRScsICdUSEVOJywgJ0VORF9JRiddLFxyXG4gICAgY2FzZVN0YXRlbWVudEtleXdvcmRzOiBbJ0NBU0UnLCAnT0YnLCAnRU5EX0NBU0UnXSxcclxuICAgIGZvclN0YXRlTWVudEtleXdvcmRzOiBbJ0ZPUicsICdUTycsICdCWScsICdETycsICdFTkRfRk9SJ10sXHJcbiAgICB3aGlsZVN0YXRlbWVudEtleXdvcmRzOiBbJ1dISUxFJywgJ0RPJywgJ0VORF9XSElMRSddLFxyXG4gICAgcmVwZWF0U3RhdG1lbnRLZXl3b3JkczogWydSRVBFQVQnLCAnVU5USUwnLCAnRU5EX1JFUEVBVCddLFxyXG4gICAgY29udGludWVLZXl3b3JkOiBbJ0NPTlRJTlVFJ10sXHJcbiAgICBleGl0U3RhdGVtZW50S2V5d29yZHM6IFsnRVhJVCddLFxyXG4gICAgcmV0dXJuU3RhdGVtZW50S2V5d29yZHM6IFsnUkVUVVJOJ11cclxuICB9O1xyXG5cclxuICBjb25zdCB0eXBlZEtleXdvcmRHcm91cHMgPSB7XHJcbiAgICBpbnRLZXl3b3JkczogWydVU0lOVCcsICdTSU5UJywgJ1VJTlQnLCAnSU5UJywgJ1VESU5UJywgJ0RJTlQnLCAnVUxJTlQnLCAnTElOVCddLFxyXG4gICAgZmxvYXRLZXl3b3JkczogWydSRUFMJywgJ0xSRUFMJ10sXHJcbiAgICBib29sS2V5d29yZHM6IFsnQk9PTCddLFxyXG4gICAgc3RyaW5nS2V5d29yZHM6IFsnU1RSSU5HJywgJ1dTVFJJTkcnXSxcclxuICAgIGJpbktleXdvcmRzOiBbJ0JZVEUnLCAnV09SRCcsICdEV09SRCcsICdMV09SRCddLFxyXG4gICAgdGltZUtleXdvcmRzOiBbJ1RJTUUnLCAnTFRJTUUnXVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGRlY2xhcmF0aW9uS2V5d29yZHMgPSB7XHJcbiAgICB2YXJpYWJsZXM6IFsnVkFSJywgJ1ZBUl9JTlBVVCcsICdWQVJfT1VUUFVUJywgJ1ZBUl9JTl9PVVQnLCAnVkFSX1RFTVAnLCAnVkFSX0NPTlNUQU5UJywgJ0VORF9WQVInXSxcclxuICAgIHR5cGVzOiBbJ1RZUEUnLCAnRU5EX1RZUEUnLCAnU1RSVUNUJywgJ0VORF9TVFJVQ1QnXSxcclxuICAgIGZ1bmN0aW9uczogWydGVU5DVElPTicsICdFTkRfRlVOQ1RJT04nLCAnRlVOQ1RJT05fQkxPQ0snLCAnRU5EX0ZVTkNUSU9OX0JMT0NLJ11cclxuICB9O1xyXG5cclxuICBjb25zdCBhbGxLZXl3b3JkcyA9IFtcclxuICAgIC4uLk9iamVjdC52YWx1ZXMoY29udHJvbEtleXdvcmRHcm91cHMpLmZsYXQoKSxcclxuICAgIC4uLk9iamVjdC52YWx1ZXModHlwZWRLZXl3b3JkR3JvdXBzKS5mbGF0KCksXHJcbiAgICAuLi5PYmplY3QudmFsdWVzKGRlY2xhcmF0aW9uS2V5d29yZHMpLmZsYXQoKVxyXG4gIF07XHJcblxyXG4gIGNvbnN0IGtleXdvcmRSZWdleCA9IG5ldyBSZWdFeHAoYFxcXFxiKCR7YWxsS2V5d29yZHMuam9pbignfCcpfSkoPz0kfFxcXFxzfFteXFxcXHddKWAsICdpJyk7XHJcblxyXG4gIFByaXNtLmxhbmd1YWdlcy5zdHJ1Y3R1cmVkdGV4dCA9IFByaXNtLmxhbmd1YWdlcy5leHRlbmQoJ2NsaWtlJywge1xyXG5cclxuXHJcbiAgICBrZXl3b3JkOiBrZXl3b3JkUmVnZXgsXHJcbiAgICBib29sZWFuOiAvXFxiKFRSVUV8RkFMU0UpXFxiLyxcclxuICAgIG9wZXJhdG9yOiAvXFxiKEFORHxPUnxOT1R8WE9SKVxcYnw6PXw8Pnw8PXw+PXw8fD4vLFxyXG4gICAgbnVtYmVyOiAvXFxiXFxkKyhcXC5cXGQrKT9cXGIvLFxyXG4gICAgcHVuY3R1YXRpb246IC9bKCk7LF0vLFxyXG4gICAgaWRlbnRpZmllcjogL1xcYltBLVphLXpfXVtBLVphLXowLTlfXSpcXGIvXHJcbiAgfSk7XHJcblxyXG4gIFByaXNtLmhvb2tzLmFkZCgnd3JhcCcsIChlbnY6IHtcclxuICAgIHR5cGU6IHN0cmluZywgYXR0cmlidXRlczogeyBbeDogc3RyaW5nXTogYW55IH07XHJcbiAgICBjb250ZW50OiBzdHJpbmdcclxuICB9KSA9PiB7XHJcbiAgICBpZiAoZW52LnR5cGUgPT09ICdlbnRpdHknKSB7XHJcbiAgICAgIGVudi5hdHRyaWJ1dGVzWyd0aXRsZSddID0gZW52LmNvbnRlbnQucmVwbGFjZSgvJmFtcDsvLCAnJicpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuXHJcbn07XHJcblxyXG5jb25zdCBsb2FkUHJpc21XaXRoU1QgPSBhc3luYyAoKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IFByaXNtID0gYXdhaXQgbG9hZFByaXNtKCk7XHJcbiAgICBhcHBseVByaXNtU1QoUHJpc20pO1xyXG4gICAgcmV0dXJuIFByaXNtO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvYWQgUHJpc206XCIsIGVycm9yKTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufTtcclxuXHJcblxyXG5leHBvcnQgZGVmYXVsdCBsb2FkUHJpc21XaXRoU1Q7XHJcbiIsICJpbXBvcnQgeyBEZWNvcmF0aW9uLCBEZWNvcmF0aW9uU2V0LCBFZGl0b3JWaWV3LCBQbHVnaW5WYWx1ZSwgVmlld1VwZGF0ZSB9IGZyb20gXCJAY29kZW1pcnJvci92aWV3XCI7XHJcbmltcG9ydCB7IFJhbmdlU2V0QnVpbGRlciB9IGZyb20gXCJAY29kZW1pcnJvci9zdGF0ZVwiO1xyXG5pbXBvcnQgbG9hZFByaXNtV2l0aFNUIGZyb20gXCJsb2FkUHJpc21XaXRoU1RcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFN0cnVjdHVyZWRUZXh0SGlnaGxpZ2h0IGltcGxlbWVudHMgUGx1Z2luVmFsdWUge1xyXG4gIGRlY29yYXRpb25zOiBEZWNvcmF0aW9uU2V0O1xyXG4gIHByaXNtOiBhbnk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHZpZXc6IEVkaXRvclZpZXcpIHtcclxuICAgIHRoaXMuZGVjb3JhdGlvbnMgPSBEZWNvcmF0aW9uLm5vbmU7XHJcbiAgICB0aGlzLmxvYWRQcmlzbSgpLnRoZW4oKCkgPT4ge1xyXG4gICAgICB0aGlzLmRlY29yYXRpb25zID0gdGhpcy5idWlsZERlY29yYXRpb25zKHZpZXcpO1xyXG4gICAgICB2aWV3LnVwZGF0ZShbXSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZSh1cGRhdGU6IFZpZXdVcGRhdGUpOiB2b2lkIHtcclxuICAgIGlmICh1cGRhdGUudmlld3BvcnRDaGFuZ2VkIHx8IHVwZGF0ZS5kb2NDaGFuZ2VkKSB7XHJcbiAgICAgIHRoaXMuZGVjb3JhdGlvbnMgPSB0aGlzLmJ1aWxkRGVjb3JhdGlvbnModXBkYXRlLnZpZXcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgbG9hZFByaXNtKCkge1xyXG4gICAgdGhpcy5wcmlzbSA9IGF3YWl0IGxvYWRQcmlzbVdpdGhTVCgpO1xyXG4gIH1cclxuXHJcbiAgYnVpbGREZWNvcmF0aW9ucyh2aWV3OiBFZGl0b3JWaWV3KTogRGVjb3JhdGlvblNldCB7XHJcbiAgICBjb25zdCBidWlsZGVyID0gbmV3IFJhbmdlU2V0QnVpbGRlcjxEZWNvcmF0aW9uPigpO1xyXG5cclxuICAgIGlmICghdGhpcy5wcmlzbSkge1xyXG4gICAgICByZXR1cm4gRGVjb3JhdGlvbi5ub25lO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRleHQgPSB2aWV3LnN0YXRlLmRvYy50b1N0cmluZygpO1xyXG4gICAgY29uc3QgcmVnZXggPSAvYGBgc3RydWN0dXJlZHRleHQoPzpbXFxzXFxTXSo/KShbXFxzXFxTXSo/KVxcbmBgYC9naTtcclxuXHJcbiAgICBsZXQgbWF0Y2g7XHJcbiAgICB3aGlsZSAoKG1hdGNoID0gcmVnZXguZXhlYyh0ZXh0KSkgIT09IG51bGwpIHtcclxuICAgICAgY29uc3QgY29kZUJsb2NrID0gbWF0Y2hbMV07XHJcbiAgICAgIGNvbnN0IGhpZ2hsaWdodGVkID0gdGhpcy5wcmlzbS5oaWdobGlnaHQoY29kZUJsb2NrLCB0aGlzLnByaXNtLmxhbmd1YWdlcy5zdHJ1Y3R1cmVkdGV4dCwgXCJzdHJ1Y3R1cmVkdGV4dFwiKTtcclxuXHJcbiAgICAgIGNvbnN0IGJsb2NrU3RhcnQgPSBtYXRjaC5pbmRleCArIG1hdGNoWzBdLmluZGV4T2YobWF0Y2hbMV0pO1xyXG4gICAgICB0aGlzLmFwcGx5SGlnaGxpZ2h0aW5nKGhpZ2hsaWdodGVkLCBibG9ja1N0YXJ0LCBidWlsZGVyKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gYnVpbGRlci5maW5pc2goKTtcclxuICB9XHJcblxyXG4gIGFwcGx5SGlnaGxpZ2h0aW5nKGhpZ2hsaWdodGVkOiBzdHJpbmcsIGJsb2NrU3RhcnQ6IG51bWJlciwgYnVpbGRlcjogUmFuZ2VTZXRCdWlsZGVyPERlY29yYXRpb24+KSB7XHJcbiAgICBjb25zdCBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7XHJcbiAgICBjb25zdCBkb2MgPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKGhpZ2hsaWdodGVkLCBcInRleHQvaHRtbFwiKTtcclxuICAgIGNvbnN0IHRlbXBFbCA9IGRvYy5ib2R5O1xyXG5cclxuICAgIGxldCBjdXJyZW50SW5kZXggPSBibG9ja1N0YXJ0O1xyXG4gICAgY29uc3QgcmFuZ2VzOiB7IHN0YXJ0OiBudW1iZXI7IGVuZDogbnVtYmVyOyBjbGFzc05hbWU6IHN0cmluZyB9W10gPSBbXTtcclxuXHJcbiAgICBjb25zdCB0cmF2ZXJzZSA9IChub2RlOiBOb2RlKSA9PiB7XHJcbiAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSBOb2RlLlRFWFRfTk9ERSkge1xyXG4gICAgICAgIGNvbnN0IHRleHQgPSBub2RlLnRleHRDb250ZW50IHx8IFwiXCI7XHJcbiAgICAgICAgY3VycmVudEluZGV4ICs9IHRleHQubGVuZ3RoO1xyXG4gICAgICB9IGVsc2UgaWYgKG5vZGUubm9kZVR5cGUgPT09IE5vZGUuRUxFTUVOVF9OT0RFKSB7XHJcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IG5vZGUgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gZWxlbWVudC5jbGFzc05hbWU7XHJcblxyXG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gY3VycmVudEluZGV4O1xyXG4gICAgICAgIGVsZW1lbnQuY2hpbGROb2Rlcy5mb3JFYWNoKChjaGlsZCkgPT4gdHJhdmVyc2UoY2hpbGQpKTtcclxuICAgICAgICBjb25zdCBlbmQgPSBjdXJyZW50SW5kZXggKyAxO1xyXG5cclxuICAgICAgICBpZiAoY2xhc3NOYW1lICYmIGVuZCA+IHN0YXJ0KSB7XHJcbiAgICAgICAgICByYW5nZXMucHVzaCh7IHN0YXJ0LCBlbmQsIGNsYXNzTmFtZSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgdGVtcEVsLmNoaWxkTm9kZXMuZm9yRWFjaCgoY2hpbGQpID0+IHRyYXZlcnNlKGNoaWxkKSk7XHJcblxyXG4gICAgcmFuZ2VzLnNvcnQoKGEsIGIpID0+IGEuc3RhcnQgLSBiLnN0YXJ0KTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IHJhbmdlIG9mIHJhbmdlcykge1xyXG4gICAgICBidWlsZGVyLmFkZChyYW5nZS5zdGFydCwgcmFuZ2UuZW5kLCBEZWNvcmF0aW9uLm1hcmsoeyBjbGFzczogcmFuZ2UuY2xhc3NOYW1lIH0pKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxJQUFBQSxtQkFBdUI7OztBQ0F2QixzQkFBMEI7QUFJMUIsSUFBTSxlQUFlLENBQUMsVUFBZTtBQUVuQyxRQUFNLHVCQUF1QjtBQUFBLElBRTNCLHFCQUFxQixDQUFDLE1BQU0sU0FBUyxRQUFRLFFBQVEsUUFBUTtBQUFBLElBQzdELHVCQUF1QixDQUFDLFFBQVEsTUFBTSxVQUFVO0FBQUEsSUFDaEQsc0JBQXNCLENBQUMsT0FBTyxNQUFNLE1BQU0sTUFBTSxTQUFTO0FBQUEsSUFDekQsd0JBQXdCLENBQUMsU0FBUyxNQUFNLFdBQVc7QUFBQSxJQUNuRCx3QkFBd0IsQ0FBQyxVQUFVLFNBQVMsWUFBWTtBQUFBLElBQ3hELGlCQUFpQixDQUFDLFVBQVU7QUFBQSxJQUM1Qix1QkFBdUIsQ0FBQyxNQUFNO0FBQUEsSUFDOUIseUJBQXlCLENBQUMsUUFBUTtBQUFBLEVBQ3BDO0FBRUEsUUFBTSxxQkFBcUI7QUFBQSxJQUN6QixhQUFhLENBQUMsU0FBUyxRQUFRLFFBQVEsT0FBTyxTQUFTLFFBQVEsU0FBUyxNQUFNO0FBQUEsSUFDOUUsZUFBZSxDQUFDLFFBQVEsT0FBTztBQUFBLElBQy9CLGNBQWMsQ0FBQyxNQUFNO0FBQUEsSUFDckIsZ0JBQWdCLENBQUMsVUFBVSxTQUFTO0FBQUEsSUFDcEMsYUFBYSxDQUFDLFFBQVEsUUFBUSxTQUFTLE9BQU87QUFBQSxJQUM5QyxjQUFjLENBQUMsUUFBUSxPQUFPO0FBQUEsRUFDaEM7QUFFQSxRQUFNLHNCQUFzQjtBQUFBLElBQzFCLFdBQVcsQ0FBQyxPQUFPLGFBQWEsY0FBYyxjQUFjLFlBQVksZ0JBQWdCLFNBQVM7QUFBQSxJQUNqRyxPQUFPLENBQUMsUUFBUSxZQUFZLFVBQVUsWUFBWTtBQUFBLElBQ2xELFdBQVcsQ0FBQyxZQUFZLGdCQUFnQixrQkFBa0Isb0JBQW9CO0FBQUEsRUFDaEY7QUFFQSxRQUFNLGNBQWM7QUFBQSxJQUNsQixHQUFHLE9BQU8sT0FBTyxvQkFBb0IsRUFBRSxLQUFLO0FBQUEsSUFDNUMsR0FBRyxPQUFPLE9BQU8sa0JBQWtCLEVBQUUsS0FBSztBQUFBLElBQzFDLEdBQUcsT0FBTyxPQUFPLG1CQUFtQixFQUFFLEtBQUs7QUFBQSxFQUM3QztBQUVBLFFBQU0sZUFBZSxJQUFJLE9BQU8sT0FBTyxZQUFZLEtBQUssR0FBRyxDQUFDLHFCQUFxQixHQUFHO0FBRXBGLFFBQU0sVUFBVSxpQkFBaUIsTUFBTSxVQUFVLE9BQU8sU0FBUztBQUFBLElBRy9ELFNBQVM7QUFBQSxJQUNULFNBQVM7QUFBQSxJQUNULFVBQVU7QUFBQSxJQUNWLFFBQVE7QUFBQSxJQUNSLGFBQWE7QUFBQSxJQUNiLFlBQVk7QUFBQSxFQUNkLENBQUM7QUFFRCxRQUFNLE1BQU0sSUFBSSxRQUFRLENBQUMsUUFHbkI7QUFDSixRQUFJLElBQUksU0FBUyxVQUFVO0FBQ3pCLFVBQUksV0FBVyxPQUFPLElBQUksSUFBSSxRQUFRLFFBQVEsU0FBUyxHQUFHO0FBQUEsSUFDNUQ7QUFBQSxFQUNGLENBQUM7QUFHSDtBQUVBLElBQU0sa0JBQWtCLFlBQVk7QUFDbEMsTUFBSTtBQUNGLFVBQU0sUUFBUSxVQUFNLDJCQUFVO0FBQzlCLGlCQUFhLEtBQUs7QUFDbEIsV0FBTztBQUFBLEVBQ1QsU0FBUyxPQUFPO0FBQ2QsWUFBUSxNQUFNLHlCQUF5QixLQUFLO0FBQzVDLFVBQU07QUFBQSxFQUNSO0FBQ0Y7QUFHQSxJQUFPLDBCQUFROzs7QUM1RWYsa0JBQStFO0FBQy9FLG1CQUFnQztBQUdoQyxJQUFxQiwwQkFBckIsTUFBb0U7QUFBQSxFQUlsRSxZQUFZLE1BQWtCO0FBQzVCLFNBQUssY0FBYyx1QkFBVztBQUM5QixTQUFLLFVBQVUsRUFBRSxLQUFLLE1BQU07QUFDMUIsV0FBSyxjQUFjLEtBQUssaUJBQWlCLElBQUk7QUFDN0MsV0FBSyxPQUFPLENBQUMsQ0FBQztBQUFBLElBQ2hCLENBQUM7QUFBQSxFQUNIO0FBQUEsRUFFQSxPQUFPLFFBQTBCO0FBQy9CLFFBQUksT0FBTyxtQkFBbUIsT0FBTyxZQUFZO0FBQy9DLFdBQUssY0FBYyxLQUFLLGlCQUFpQixPQUFPLElBQUk7QUFBQSxJQUN0RDtBQUFBLEVBQ0Y7QUFBQSxFQUVBLE1BQU0sWUFBWTtBQUNoQixTQUFLLFFBQVEsTUFBTSx3QkFBZ0I7QUFBQSxFQUNyQztBQUFBLEVBRUEsaUJBQWlCLE1BQWlDO0FBQ2hELFVBQU0sVUFBVSxJQUFJLDZCQUE0QjtBQUVoRCxRQUFJLENBQUMsS0FBSyxPQUFPO0FBQ2YsYUFBTyx1QkFBVztBQUFBLElBQ3BCO0FBRUEsVUFBTSxPQUFPLEtBQUssTUFBTSxJQUFJLFNBQVM7QUFDckMsVUFBTSxRQUFRO0FBRWQsUUFBSTtBQUNKLFlBQVEsUUFBUSxNQUFNLEtBQUssSUFBSSxPQUFPLE1BQU07QUFDMUMsWUFBTSxZQUFZLE1BQU0sQ0FBQztBQUN6QixZQUFNLGNBQWMsS0FBSyxNQUFNLFVBQVUsV0FBVyxLQUFLLE1BQU0sVUFBVSxnQkFBZ0IsZ0JBQWdCO0FBRXpHLFlBQU0sYUFBYSxNQUFNLFFBQVEsTUFBTSxDQUFDLEVBQUUsUUFBUSxNQUFNLENBQUMsQ0FBQztBQUMxRCxXQUFLLGtCQUFrQixhQUFhLFlBQVksT0FBTztBQUFBLElBQ3pEO0FBRUEsV0FBTyxRQUFRLE9BQU87QUFBQSxFQUN4QjtBQUFBLEVBRUEsa0JBQWtCLGFBQXFCLFlBQW9CLFNBQXNDO0FBQy9GLFVBQU0sU0FBUyxJQUFJLFVBQVU7QUFDN0IsVUFBTSxNQUFNLE9BQU8sZ0JBQWdCLGFBQWEsV0FBVztBQUMzRCxVQUFNLFNBQVMsSUFBSTtBQUVuQixRQUFJLGVBQWU7QUFDbkIsVUFBTSxTQUE4RCxDQUFDO0FBRXJFLFVBQU0sV0FBVyxDQUFDLFNBQWU7QUFDL0IsVUFBSSxLQUFLLGFBQWEsS0FBSyxXQUFXO0FBQ3BDLGNBQU0sT0FBTyxLQUFLLGVBQWU7QUFDakMsd0JBQWdCLEtBQUs7QUFBQSxNQUN2QixXQUFXLEtBQUssYUFBYSxLQUFLLGNBQWM7QUFDOUMsY0FBTSxVQUFVO0FBQ2hCLGNBQU0sWUFBWSxRQUFRO0FBRTFCLGNBQU0sUUFBUTtBQUNkLGdCQUFRLFdBQVcsUUFBUSxDQUFDLFVBQVUsU0FBUyxLQUFLLENBQUM7QUFDckQsY0FBTSxNQUFNLGVBQWU7QUFFM0IsWUFBSSxhQUFhLE1BQU0sT0FBTztBQUM1QixpQkFBTyxLQUFLLEVBQUUsT0FBTyxLQUFLLFVBQVUsQ0FBQztBQUFBLFFBQ3ZDO0FBQUEsTUFDRjtBQUFBLElBQ0Y7QUFFQSxXQUFPLFdBQVcsUUFBUSxDQUFDLFVBQVUsU0FBUyxLQUFLLENBQUM7QUFFcEQsV0FBTyxLQUFLLENBQUMsR0FBRyxNQUFNLEVBQUUsUUFBUSxFQUFFLEtBQUs7QUFFdkMsZUFBVyxTQUFTLFFBQVE7QUFDMUIsY0FBUSxJQUFJLE1BQU0sT0FBTyxNQUFNLEtBQUssdUJBQVcsS0FBSyxFQUFFLE9BQU8sTUFBTSxVQUFVLENBQUMsQ0FBQztBQUFBLElBQ2pGO0FBQUEsRUFDRjtBQUNGOzs7QUYvRUEsSUFBQUMsZUFBMkI7QUFFM0IsUUFBUSxJQUFJLG1DQUFtQztBQUMvQyxJQUFxQix3Q0FBckIsY0FBbUUsd0JBQU87QUFBQSxFQUd4RSxNQUFNLFNBQVM7QUFDYixZQUFRLElBQUksZ0JBQWdCO0FBQzVCLFFBQUk7QUFDRixjQUFRLElBQUksNENBQTRDO0FBQ3hELFdBQUssZ0JBQWdCLE1BQU0sd0JBQWdCO0FBQzNDLGNBQVEsSUFBSSxjQUFjO0FBRTFCLFdBQUssOEJBQThCLENBQUMsSUFBSSxRQUFRO0FBQzlDLFdBQUcsaUJBQWlCLG9DQUFvQyxFQUFFLFFBQVEsQ0FBQyxVQUFVO0FBQzNFLGVBQUssY0FBYyxpQkFBaUIsS0FBSztBQUFBLFFBQzNDLENBQUM7QUFBQSxNQUNILENBQUM7QUFFRCxXQUFLO0FBQUEsUUFDSCx3QkFBVyxVQUFVLHlCQUEyQjtBQUFBLFVBQzlDLGFBQWEsQ0FBQyxXQUFXLE9BQU87QUFBQSxRQUNsQyxDQUFDO0FBQUEsTUFDSDtBQUVBLFdBQUssSUFBSSxVQUFVLGNBQWM7QUFBQSxJQUNuQyxTQUFTLE9BQU87QUFDZCxjQUFRLE1BQU0sMEJBQTBCLEtBQUs7QUFBQSxJQUMvQztBQUFBLEVBQ0Y7QUFBQSxFQUVBLFdBQVc7QUFDVCxZQUFRLElBQUkscURBQXFEO0FBRWpFLFFBQUksS0FBSyxpQkFBaUIsS0FBSyxjQUFjLFVBQVUsZ0JBQWdCO0FBQ3JFLGFBQU8sS0FBSyxjQUFjLFVBQVU7QUFBQSxJQUN0QztBQUFBLEVBQ0Y7QUFDRjsiLAogICJuYW1lcyI6IFsiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF92aWV3Il0KfQo=
